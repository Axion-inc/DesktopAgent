dsl_version: "1.1"
name: "Downloadsæ•´ç† - PDFè‡ªå‹•ãƒªãƒãƒ¼ãƒ ï¼†ä»•åˆ†ã‘"
variables:
  downloads_dir: "~/Downloads"
  archive_dir: "~/Documents/PDF_Archive"
  work_dir: "~/Documents/PDF_Work"
  personal_dir: "~/Documents/PDF_Personal"

steps:
  - find_files:
      query: "kind:pdf modified:last week"
      roots: ["{{downloads_dir}}"]
      limit: 50

  - log:
      message: "Downloadså†…ã®PDFãƒ•ã‚¡ã‚¤ãƒ«ã‚’{{steps[0].found}}ä»¶ç™ºè¦‹ã—ã¾ã—ãŸ"
      when: "{{steps[0].found}} > 0"

  - rename:
      rule: "{{date}}_tidy_{{index}}_{{basename}}"
      when: "{{steps[0].found}} > 0"

  - find_files:
      query: "name:*invoice* OR name:*è«‹æ±‚æ›¸* OR name:*receipt*"
      roots: ["{{downloads_dir}}"]
      limit: 20
      when: "{{steps[0].found}} > 0"

  - move_to:
      dest: "{{work_dir}}"
      when: "{{steps[3].found}} > 0"

  - log:
      message: "æ¥­å‹™é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«{{steps[3].found}}ä»¶ã‚’{{work_dir}}ã«ç§»å‹•"
      when: "{{steps[3].found}} > 0"

  - find_files:
      query: "name:*personal* OR name:*private* OR name:*å€‹äºº*"
      roots: ["{{downloads_dir}}"]
      limit: 20
      when: "{{steps[0].found}} > 0"

  - move_to:
      dest: "{{personal_dir}}"
      when: "{{steps[6].found}} > 0"

  - log:
      message: "å€‹äººãƒ•ã‚¡ã‚¤ãƒ«{{steps[6].found}}ä»¶ã‚’{{personal_dir}}ã«ç§»å‹•"
      when: "{{steps[6].found}} > 0"

  - find_files:
      query: "kind:pdf"
      roots: ["{{downloads_dir}}"]
      limit: 100
      when: "{{steps[0].found}} > 0"

  - move_to:
      dest: "{{archive_dir}}"
      when: "{{steps[9].found}} > 0"

  - log:
      message: "æ®‹ã‚Šã®{{steps[9].found}}ä»¶ã®PDFã‚’{{archive_dir}}ã«ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–"
      when: "{{steps[9].found}} > 0"

  - compose_mail:
      to: ["filing@example.com"]
      subject: "Downloadsè‡ªå‹•æ•´ç†å®Œäº† {{date}}"
      body: |
        PDFãƒ•ã‚¡ã‚¤ãƒ«ã®è‡ªå‹•æ•´ç†ãŒå®Œäº†ã—ã¾ã—ãŸã€‚
        
        ðŸ“Š å‡¦ç†ã‚µãƒžãƒª:
        - ç™ºè¦‹ã—ãŸPDFãƒ•ã‚¡ã‚¤ãƒ«: {{steps[0].found}}ä»¶
        - æ¥­å‹™é–¢é€£ â†’ {{work_dir}}: {{steps[3].found}}ä»¶
        - å€‹äººé–¢é€£ â†’ {{personal_dir}}: {{steps[6].found}}ä»¶  
        - ãã®ä»–ã‚¢ãƒ¼ã‚«ã‚¤ãƒ– â†’ {{archive_dir}}: {{steps[9].found}}ä»¶
        
        ðŸ”§ è‡ªå‹•ä¿®å¾©æ©Ÿèƒ½:
        {% if steps[4].self_heal %}è‡ªå‹•ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ: æœ‰åŠ¹{% endif %}
        {% if steps[0].self_heal %}æ¤œç´¢ç¯„å›²æ‹¡å¤§: æœ‰åŠ¹{% endif %}
        
        ðŸ“ˆ ã‚·ã‚¹ãƒ†ãƒ æˆåŠŸçŽ‡: {{metrics.success_rate_24h * 100}}%
      when: "{{steps[0].found}} > 0"

  - save_draft:
      when: "{{steps[0].found}} > 0"